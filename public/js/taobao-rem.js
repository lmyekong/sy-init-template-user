// - 引入该文件前不能设置meta viewport
!(function (a, b) { function c () { var u = i.getBoundingClientRect().width; u / o > 540 && (u = 540 * o); var v = u / 10; i.style.fontSize = v + 'px', q.rem = a.rem = v } var e, g = a.document, i = g.documentElement, k = g.querySelector('meta[name="viewport"]'), m = g.querySelector('meta[name="flexible"]'), o = 0, p = 0, q = b.flexible || (b.flexible = {}); if (k) { console.warn('将根据已有的meta标签来设置缩放比例'); var r = k.getAttribute('content').match(/initial\-scale=([\d\.]+)/); r && (p = parseFloat(r[1]), o = parseInt(1 / p)) } else { if (m) { var s = m.getAttribute('content'); if (s) { var t = s.match(/initial\-dpr=([\d\.]+)/), d = s.match(/maximum\-dpr=([\d\.]+)/); t && (o = parseFloat(t[1]), p = parseFloat((1 / o).toFixed(2))), d && (o = parseFloat(d[1]), p = parseFloat((1 / o).toFixed(2))) } } } if (!o && !p) { var f = a.navigator.userAgent, h = (!!f.match(/android/gi), !!f.match(/iphone/gi)), j = h && !!f.match(/OS 9_3/), l = a.devicePixelRatio; o = h && !j ? l >= 3 && (!o || o >= 3) ? 3 : l >= 2 && (!o || o >= 2) ? 2 : 1 : 1, p = 1 / o } if (i.setAttribute('data-dpr', o), !k) { if (k = g.createElement('meta'), k.setAttribute('name', 'viewport'), k.setAttribute('content', 'initial-scale=' + p + ', maximum-scale=' + p + ', minimum-scale=' + p + ', user-scalable=no'), i.firstElementChild) { i.firstElementChild.appendChild(k) } else { var n = g.createElement('div'); n.appendChild(k), g.write(n.innerHTML) } }a.addEventListener('resize', function () { clearTimeout(e), e = setTimeout(c, 300) }, !1), a.addEventListener('pageshow', function (u) { u.persisted && (clearTimeout(e), e = setTimeout(c, 300)) }, !1), g.readyState === 'complete' ? g.body.style.fontSize = 12 * o + 'px' : g.addEventListener('DOMContentLoaded', function () { g.body.style.fontSize = 12 * o + 'px' }, !1), c(), q.dpr = a.dpr = o, q.refreshRem = c, q.rem2px = function (u) { var v = parseFloat(u) * this.rem; return typeof u === 'string' && u.match(/rem$/) && (v += 'px'), v }, q.px2rem = function (u) { var v = parseFloat(u) / this.rem; return typeof u === 'string' && u.match(/px$/) && (v += 'rem'), v } }(window, window.lib || (window.lib = {})))
